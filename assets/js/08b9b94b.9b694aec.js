"use strict";(globalThis.webpackChunktp_2025_t_23=globalThis.webpackChunktp_2025_t_23||[]).push([[4197],{204:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"data-science/text_service","title":"EvilFlowers Text Service","description":"1. \xda\u010del syst\xe9mu","source":"@site/docs/data-science/02_text_service.md","sourceDirName":"data-science","slug":"/data-science/text_service","permalink":"/TP2025-T23/docs/data-science/text_service","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"documentationSidebar","previous":{"title":"Diagramy","permalink":"/TP2025-T23/docs/data-science/diagrams"},"next":{"title":"System Engineering","permalink":"/TP2025-T23/docs/category/system-engineering"}}');var d=i(4848),r=i(8453);const l={sidebar_position:2},c="EvilFlowers Text Service",o={},t=[{value:"1. \xda\u010del syst\xe9mu",id:"1-\xfa\u010del-syst\xe9mu",level:2},{value:"2. High-level architekt\xfara",id:"2-high-level-architekt\xfara",level:2},{value:"3. Komponenty",id:"3-komponenty",level:2},{value:"3.1 TextExtractor",id:"31-textextractor",level:3},{value:"3.2 TextHandler / TextService",id:"32-texthandler--textservice",level:3},{value:"3.3 SemanticIndexer",id:"33-semanticindexer",level:3},{value:"3.4 EmbeddingGenerator",id:"34-embeddinggenerator",level:3},{value:"3.5 MilvusManager",id:"35-milvusmanager",level:3},{value:"3.6 SemanticSearch",id:"36-semanticsearch",level:3},{value:"4. Konfigur\xe1cia a prostredia",id:"4-konfigur\xe1cia-a-prostredia",level:2},{value:"5. Identifikovan\xe9 a vyrie\u0161en\xe9 kritick\xe9 probl\xe9my",id:"5-identifikovan\xe9-a-vyrie\u0161en\xe9-kritick\xe9-probl\xe9my",level:2},{value:"Architecture Class Diagram",id:"architecture-class-diagram",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"evilflowers-text-service",children:"EvilFlowers Text Service"})}),"\n",(0,d.jsx)(n.h2,{id:"1-\xfa\u010del-syst\xe9mu",children:"1. \xda\u010del syst\xe9mu"}),"\n",(0,d.jsx)(n.p,{children:"Syst\xe9m zabezpe\u010duje plnohodnotn\xfd kan\xe1l od akademick\xe9ho PDF dokumentu a\u017e po s\xe9mantick\xe9 vyh\u013ead\xe1vanie nad ulo\u017een\xfdmi vektorov\xfdmi reprezent\xe1ciami textu. Cie\u013eom je:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"bezstratovo extrahova\u0165 text (vr\xe1tane slovenskej diakritiky),"}),"\n",(0,d.jsx)(n.li,{children:"konzistentne ho \u0161trukt\xfarova\u0165 (strany, odseky, vety),"}),"\n",(0,d.jsx)(n.li,{children:"pripravi\u0165 embeddingy vhodn\xe9 pre multijazy\u010dn\xe9 s\xe9mantick\xe9 vyh\u013ead\xe1vanie,"}),"\n",(0,d.jsx)(n.li,{children:"uklada\u0165 ich do vektorovej datab\xe1zy Milvus,"}),"\n",(0,d.jsx)(n.li,{children:"spr\xedstupni\u0165 vyh\u013ead\xe1vanie cez API / mikroslu\u017eby (Django, Celery, Kafka),"}),"\n",(0,d.jsx)(n.li,{children:"umo\u017eni\u0165 \u0161k\xe1lovanie na desiatky a\u017e stovky tis\xedc dokumentov."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"2-high-level-architekt\xfara",children:"2. High-level architekt\xfara"}),"\n",(0,d.jsx)(n.p,{children:"End-to-end tok:"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"1. Vstup dokumentu"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Zdroj: lok\xe1lny s\xfabor, upload cez API, spr\xe1va z Kafka topicu (napr. \u201enov\xfd PDF dokument\u201c)."}),"\n",(0,d.jsx)(n.li,{children:"Dokument je ulo\u017een\xfd v s\xfaborovom syst\xe9me / objektovom storage (napr. S3/MinIO)."}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"2. TextHandler / TextExtractor"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Na z\xe1klade typu PDF:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"digit\xe1lne PDF \u2192 priama extrakcia textu cez PyMuPDF,"}),"\n",(0,d.jsxs)(n.li,{children:["naskenovan\xe9 PDF \u2192 OCR pipeline cez ",(0,d.jsx)(n.code,{children:"ocrmypdf"})," + ",(0,d.jsx)(n.code,{children:"pytesseract"}),".\nV\xfdstup: \u0161trukt\xfarovan\xfd zoznam str\xe1n vo forme slovn\xedkov:"]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"{\n    'page_num': int,\n    'text': str,\n    'paragraphs': List[str],\n    'sentences': List[str]\n} \n"})}),"\n"]}),"\n",(0,d.jsx)(n.li,{children:"Volite\u013ene aj TOC (obsah) v samostatnej \u0161trukt\xfare."}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"3. TextProcessor (chunkovanie pre embeddingy)"})}),"\n",(0,d.jsx)(n.p,{children:"Post-processing extrahovan\xe9ho textu:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"detekcia jazyka (sloven\u010dina / angli\u010dtina),"}),"\n",(0,d.jsx)(n.li,{children:"s\xe9mantick\xe9 delenie na bloky vhodn\xe9 pre embedding (napr. 512 tokenov, prekrytie 50 tokenov),"}),"\n",(0,d.jsx)(n.li,{children:"pr\xedprava metad\xe1t (ID dokumentu, \u010d\xedslo strany, index odseku, d\u013a\u017eka textu)."}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["V aktu\xe1lnej implement\xe1cii je chunkovanie realizovan\xe9 priamo v ",(0,d.jsx)(n.code,{children:"SemanticIndexer._prepare_chunks()"})," na \xfarovni str\xe1n/odsekov; nesk\xf4r sa roz\u0161\xedri o LlamaIndex SentenceSplitter."]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"4. SemanticIndexer"})}),"\n",(0,d.jsx)(n.p,{children:"Zodpovedn\xfd za:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"pr\xedpravu chunkov z d\xe1t TextHandleru/Processoru,"}),"\n",(0,d.jsxs)(n.li,{children:["generovanie embeddingov pomocou ",(0,d.jsx)(n.code,{children:"EmbeddingGenerator"}),","]}),"\n",(0,d.jsxs)(n.li,{children:["ulo\u017eenie embeddingov a metad\xe1t do Milvus cez ",(0,d.jsx)(n.code,{children:"MilvusManager"}),"."]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"5. MilvusManager (vektorov\xe1 datab\xe1za)"})}),"\n",(0,d.jsx)(n.p,{children:"Spr\xe1va kolekcie vo vektorovej DB Milvus / Milvus Lite:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"sch\xe9ma,"}),"\n",(0,d.jsx)(n.li,{children:"indexy (HNSW / AUTOINDEX),"}),"\n",(0,d.jsx)(n.li,{children:"insert, search, delete, \u0161tatistiky."}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"6. SemanticSearch"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Generuje embedding pre dopyt (fulltextov\xe1 veta alebo ot\xe1zka),"}),"\n",(0,d.jsx)(n.li,{children:"vykon\xe1 vektorov\xfa query nad Milvus,"}),"\n",(0,d.jsx)(n.li,{children:"vr\xe1ti najrelevantnej\u0161ie \xfaseky textu s metad\xe1tami (sk\xf3re, strana, typ chunka, n\xe1h\u013ead textu)."}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"7. Orchestr\xe1cia a integr\xe1cia"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Django REST API poskytuje HTTP endpointy:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"upload dokumentu a jeho indexovanie,"}),"\n",(0,d.jsx)(n.li,{children:"s\xe9mantick\xe9 vyh\u013ead\xe1vanie,"}),"\n",(0,d.jsx)(n.li,{children:"diagnostick\xe9 endpointy (\u0161tatistiky kolekcie)."}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.li,{children:"Celery worker vykon\xe1va \u0165a\u017e\u0161ie \xfalohy (extrakcia textu, embeddingy, indexovanie)."}),"\n",(0,d.jsx)(n.li,{children:"Kafka topic sl\xfa\u017ei na integr\xe1ciu s extern\xfdmi syst\xe9mami (napr. Dataverse, in\xe9 repozit\xe1re); spr\xe1va obsahuje metad\xe1 o dokumente a cestu k PDF."}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"8. Testovanie a valid\xe1cia"})}),"\n",(0,d.jsxs)(n.p,{children:["\u0160peci\xe1lny integra\u010dn\xfd test ",(0,d.jsx)(n.code,{children:"test_milvus_local.py"}),":"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"sp\xfa\u0161\u0165a pipeline nad re\xe1lnym PDF alebo nad vzorkou d\xe1t,"}),"\n",(0,d.jsx)(n.li,{children:"pou\u017e\xedva Milvus Lite (embedded DB),"}),"\n",(0,d.jsx)(n.li,{children:"overuje extrakciu, indexovanie, vyh\u013ead\xe1vanie aj \u0161tatistiky kolekcie."}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"3-komponenty",children:"3. Komponenty"}),"\n",(0,d.jsx)(n.h3,{id:"31-textextractor",children:"3.1 TextExtractor"}),"\n",(0,d.jsx)(n.p,{children:"Zodpoved\xe1 za v\u0161etku logiku okolo PDF:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Valid\xe1cia cesty k dokumentu."}),"\n",(0,d.jsxs)(n.li,{children:["Otvorenie dokumentu cez ",(0,d.jsx)(n.code,{children:"fitz.open"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["Met\xf3da ",(0,d.jsx)(n.code,{children:"_is_digital(doc)"})," rozhoduje medzi digit\xe1lnym a OCR re\u017eimom:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"prech\xe1dza prv\xfdch N str\xe1n (max. 30),"}),"\n",(0,d.jsx)(n.li,{children:"ak n\xe1jde dostato\u010dne dlh\xfd extrahovate\u013en\xfd text, dokument sa pova\u017euje za digit\xe1lny."}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Met\xf3da ",(0,d.jsx)(n.code,{children:"extract()"})," je jedin\xfd vstupn\xfd bod:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["pri digit\xe1lnom dokumente vol\xe1 ",(0,d.jsx)(n.code,{children:"_extract_digital(doc)"}),","]}),"\n",(0,d.jsxs)(n.li,{children:["pri naskenovanom dokumente vol\xe1 ",(0,d.jsx)(n.code,{children:"_extract_ocr()"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsxs)(n.strong,{children:["Digit\xe1lna vetva (",(0,d.jsx)(n.code,{children:"_extract_digital"}),")"]})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Pou\u017e\xedva ",(0,d.jsx)(n.code,{children:'page.get_text("blocks")'})," pre z\xedskanie blokov textu s poz\xedciou."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Ka\u017ed\xfd blok prech\xe1dza funkciou ",(0,d.jsx)(n.code,{children:"_clean_whitespace"}),":"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"opravuje hyfenizovan\xe9 word-\\nwrap,"}),"\n",(0,d.jsx)(n.li,{children:"nahr\xe1dza nov\xe9 riadky medzerami,"}),"\n",(0,d.jsx)(n.li,{children:"zjednocuje viacn\xe1sobn\xe9 medzery."}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Z blokov sa vytv\xe1ra:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"page_text"})," \u2013 text celej strany,"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"page_paragraphs"})," \u2013 bloky dlh\u0161ie ako definovan\xfd prah,"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"page_sentences"})," \u2013 rozdelenie na vety cez ",(0,d.jsx)(n.code,{children:"nltk.sent_tokenize"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"V\xfdsledok pre ka\u017ed\xfa stranu:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"{\n    'page_num': page_num,\n    'text': page_text, \n    'paragraphs': page_paragraphs, \n    'sentences': page_sentences\n}\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsxs)(n.strong,{children:["OCR vetva (",(0,d.jsx)(n.code,{children:"_extract_ocr"}),")"]})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Dokument sa spracuje cez ",(0,d.jsx)(n.code,{children:"ocrmypdf.ocr"})," do bufferu ",(0,d.jsx)(n.code,{children:"BytesIO"}),"."]}),"\n",(0,d.jsxs)(n.li,{children:["N\xe1sledne sa PDF-byty konvertuj\xfa na bitmapov\xe9 strany (",(0,d.jsx)(n.code,{children:"pdf2image.convert_from_bytes"}),")."]}),"\n",(0,d.jsxs)(n.li,{children:["Z ka\u017edej strany sa pomocou ",(0,d.jsx)(n.code,{children:"pytesseract.image_to_string"})," vytiahne text."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"_split_into_paragraphs"})," rozdel\xed text na odseky s heuristikami pre:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"hlavi\u010dky (ABSTRACT, INTRODUCTION, at\u010f.),"}),"\n",(0,d.jsx)(n.li,{children:"kontaktn\xe9 riadky (department, university, email),"}),"\n",(0,d.jsx)(n.li,{children:"pokra\u010dovanie viet."}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.li,{children:"Vety sa pri OCR vetve skladaj\xfa jednoduch\u0161\xedm delen\xedm na \u201e.\u201c s \u010disten\xedm."}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"TOC (obsah)"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"_check_toc"})," obsahuje z\xe1kladn\xfa heuristiku na detekciu pr\xedtomnosti obsahu."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"_extract_toc"})," je zatia\u013e stub \u2013 bude doplnen\xfd pod\u013ea potreby:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"extrakcia \u0161trukt\xfarovanej hierarchie kapitola \u2192 podkapitola \u2192 strana,"}),"\n",(0,d.jsx)(n.li,{children:"pou\u017eitie pre navig\xe1ciu pri vyh\u013ead\xe1van\xed / zobrazen\xed v\xfdsledkov."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"32-texthandler--textservice",children:"3.2 TextHandler / TextService"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"TextHandler"})," zap\xfazdruje pr\xe1cu s ",(0,d.jsx)(n.code,{children:"TextExtractor"})," a pr\xedpadn\xe9 \u010fal\u0161ie kroky (napr. detekcia TOC)."]}),"\n",(0,d.jsxs)(n.li,{children:["Typick\xfd tok:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["inicializ\xe1cia ",(0,d.jsx)(n.code,{children:"TextHandler(pdf_path)"}),","]}),"\n",(0,d.jsxs)(n.li,{children:["volanie ",(0,d.jsx)(n.code,{children:"extract_text(found_toc=False)"}),","]}),"\n",(0,d.jsxs)(n.li,{children:["n\xe1vrat ",(0,d.jsx)(n.code,{children:"pages, toc"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"TextService"})," m\xf4\u017ee poskytova\u0165 vy\u0161\u0161iu vrstvu:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"koordin\xe1cia ukladania surov\xfdch str\xe1n do DB,"}),"\n",(0,d.jsxs)(n.li,{children:["volanie ",(0,d.jsx)(n.code,{children:"SemanticIndexer"}),","]}),"\n",(0,d.jsx)(n.li,{children:"logovanie a audit (\u010das spracovania, po\u010dty str\xe1n, jazyky)."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"33-semanticindexer",children:"3.3 SemanticIndexer"}),"\n",(0,d.jsx)(n.p,{children:"Zodpovedn\xfd za transl\xe1ciu text \u2192 embedding \u2192 Milvus."}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Pri inicializ\xe1cii vytv\xe1ra:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"EmbeddingGenerator"})," (model),"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"MilvusManager"})," (kolekcia)."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Met\xf3da ",(0,d.jsx)(n.code,{children:"index_document(document_id, pages)"}),":","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Zavol\xe1 ",(0,d.jsx)(n.code,{children:"_prepare_chunks(pages)"}),":","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["pod\u013ea ",(0,d.jsx)(n.code,{children:"SemanticConfig.CHUNK_LEVEL"})," (paragraph / page),"]}),"\n",(0,d.jsxs)(n.li,{children:["pri odsekoch filtruje ",(0,d.jsx)(n.code,{children:"_is_valid_paragraph"})," (minim\xe1lny po\u010det slov, filtr\xe1cia boilerplate typu Table of Contents, Zoznam obr\xe1zkov)."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Pre vzniknut\xe9 ",(0,d.jsx)(n.code,{children:"chunks: List[str]"})," vygeneruje embeddingy:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"EmbeddingGenerator.generate_embeddings(...)"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Zavol\xe1 ",(0,d.jsx)(n.code,{children:"MilvusManager.insert_embeddings(...)"})," s embeddingmi a metad\xe1tami:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"page_num"}),","]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"chunk_type"})," (paragraph / page),"]}),"\n",(0,d.jsx)(n.li,{children:"index odseku,"}),"\n",(0,d.jsx)(n.li,{children:"text (truncovan\xfd na 2000 znakov),"}),"\n",(0,d.jsx)(n.li,{children:"d\u013a\u017eka textu."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["N\xe1vratov\xe1 hodnota obsahuje:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"success"}),","]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"chunks_indexed"}),","]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"chunk_level"}),","]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"embedding_dim"}),","]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"document_id"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"34-embeddinggenerator",children:"3.4 EmbeddingGenerator"}),"\n",(0,d.jsxs)(n.p,{children:["Generuje vektorov\xe9 reprezent\xe1cie textu pomocou ",(0,d.jsx)(n.code,{children:"sentence-transformers"}),"."]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Model sa na\u010d\xedtava na z\xe1klade ",(0,d.jsx)(n.code,{children:"SemanticConfig.MODEL_NAME"}),":","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["napr. BGE model (",(0,d.jsx)(n.code,{children:"BAAI/bge-m3"}),") alebo XLM-R sentence-transformers."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Pou\u017e\xedva konfigurovan\xe9 parametre:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"SemanticConfig.DEVICE"})," (\u201ecpu\u201c / \u201ecuda\u201c),"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"SemanticConfig.BATCH_SIZE"}),","]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"SemanticConfig.MAX_SEQUENCE_LENGTH"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Met\xf3dy:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"generate_embeddings(texts: List[str], ...) -> np.ndarray"})," \u2013 batchov\xe9 spracovanie,"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"generate_single_embedding(text: str)"})," \u2013 zabalen\xe9 volanie pre jeden dopyt,"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"get_model_info()"})," \u2013 diagnostika konfigur\xe1cie modelu."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["Embeddingy s\xfa typicky normalizovan\xe9 (",(0,d.jsx)(n.code,{children:"normalize_embeddings=True"}),"), \u010do je vhodn\xe9 pre COSINE metriku v Milvus."]}),"\n",(0,d.jsx)(n.h3,{id:"35-milvusmanager",children:"3.5 MilvusManager"}),"\n",(0,d.jsx)(n.p,{children:"Abstrakcia nad vektorovou DB Milvus:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Podporuje dva re\u017eimy:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Milvus Lite (embedded)"})," \u2013 aktivovan\xfd cez ",(0,d.jsx)(n.code,{children:"USE_MILVUS_LITE=true"}),",","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["pripojenie cez ",(0,d.jsx)(n.code,{children:'connections.connect(alias="default",'})," ",(0,d.jsx)(n.code,{children:"uri=db_file)"}),","]}),"\n",(0,d.jsx)(n.li,{children:"vhodn\xe9 pre lok\xe1lny v\xfdvoj a integra\u010dn\xe9 testy."}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Milvus server"})," \u2013 pripojenie na klasick\xfd Milvus cluster,","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["host/port sa \u010d\xedta z ",(0,d.jsx)(n.code,{children:"SemanticConfig.MILVUS_HOST"}),", ",(0,d.jsx)(n.code,{children:"MILVUS_PORT"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Sch\xe9ma kolekcie"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"id"})," \u2013 INT64, prim\xe1rny k\u013e\xfa\u010d, auto_id,"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"document_id"})," \u2013 VARCHAR(255),"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"page_num"})," \u2013 INT64,"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"chunk_type"})," \u2013 VARCHAR(50),"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"paragraph_idx"})," \u2013 INT64,"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"text"})," \u2013 VARCHAR(2000),"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"text_length"})," \u2013 INT64,"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"embedding"})," \u2013 FLOAT_VECTOR(dim = ",(0,d.jsx)(n.code,{children:"SemanticConfig.EMBEDDING_DIM"}),"),"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"created_at"})," \u2013 VARCHAR(50) (ISO timestamp)."]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"Indexovanie"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Milvus Lite:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"index_type = AUTOINDEX"}),","]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"metric_type = COSINE"}),"."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["Milvus server:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"index_type = HNSW"}),","]}),"\n",(0,d.jsxs)(n.li,{children:["parametre napr. ",(0,d.jsx)(n.code,{children:"M=16"}),", ",(0,d.jsx)(n.code,{children:"efConstruction=256"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"API met\xf3dy"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"insert_embeddings(document_id, embeddings, metadata) -> List[int]"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"vlo\u017e\xed embeddingy a metad\xe1, flushne kolekciu."}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"search(query_embedding, top_k, document_id=None, page_num=None) -> List[Dict]"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["podporuje filter cez ",(0,d.jsx)(n.code,{children:"expr"}),":","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["pod\u013ea ",(0,d.jsx)(n.code,{children:"document_id"}),","]}),"\n",(0,d.jsxs)(n.li,{children:["pod\u013ea ",(0,d.jsx)(n.code,{children:"page_num"}),","]}),"\n",(0,d.jsx)(n.li,{children:"alebo kombin\xe1ciu."}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["vracia zoznam v\xfdsledkov s:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"id"}),", ",(0,d.jsx)(n.code,{children:"score"}),", ",(0,d.jsx)(n.code,{children:"distance"}),","]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"document_id"}),", ",(0,d.jsx)(n.code,{children:"page_num"}),", ",(0,d.jsx)(n.code,{children:"chunk_type"}),", ",(0,d.jsx)(n.code,{children:"paragraph_idx"}),", ",(0,d.jsx)(n.code,{children:"text"}),", ",(0,d.jsx)(n.code,{children:"text_length"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"delete_by_document_id(document_id) -> int"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"hromadn\xe9 zmazanie v\u0161etk\xfdch vektorov dan\xe9ho dokumentu."}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"get_stats()"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"n\xe1zov kolekcie, po\u010det ent\xedt, embedding_dim."}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"close()"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"uvo\u013enenie kolekcie a odpojenie."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"36-semanticsearch",children:"3.6 SemanticSearch"}),"\n",(0,d.jsx)(n.p,{children:"Komponent na strane vyh\u013ead\xe1vania (k\xf3d nie je uveden\xfd, ale logika je dan\xe1 pou\u017eit\xedm v testoch):"}),"\n",(0,d.jsx)(n.p,{children:"Pri inicializ\xe1cii:"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["vytv\xe1ra ",(0,d.jsx)(n.code,{children:"EmbeddingGenerator"}),","]}),"\n",(0,d.jsxs)(n.li,{children:["vytv\xe1ra ",(0,d.jsx)(n.code,{children:"MilvusManager"})," alebo pou\u017e\xedva existuj\xfacu instanciu (singleton)."]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["Met\xf3da ",(0,d.jsx)(n.code,{children:"search(query, top_k, document_id=None)"}),":"]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["vygeneruje embedding dopytu cez ",(0,d.jsx)(n.code,{children:"EmbeddingGenerator.generate_single_embedding"}),","]}),"\n",(0,d.jsxs)(n.li,{children:["zavol\xe1 ",(0,d.jsx)(n.code,{children:"MilvusManager.search(...)"}),","]}),"\n",(0,d.jsxs)(n.li,{children:["v\xfdsledky transformuje na slovn\xedky:","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"score"}),", ",(0,d.jsx)(n.code,{children:"page_num"}),", ",(0,d.jsx)(n.code,{children:"chunk_type"}),", ",(0,d.jsx)(n.code,{children:"text"}),", pr\xedpadne \u010fal\u0161ie polia."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"Pou\u017eitie:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"priamo v integra\u010dnom teste,"}),"\n",(0,d.jsxs)(n.li,{children:["v API endpointoch (napr. ",(0,d.jsx)(n.code,{children:"GET /search?query=...&document_id=..."}),")."]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"4-konfigur\xe1cia-a-prostredia",children:"4. Konfigur\xe1cia a prostredia"}),"\n",(0,d.jsx)(n.p,{children:"Konfigur\xe1cia je rozdelen\xe1 na:"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"Environment variables"})," (typicky nastaven\xe9 v testoch / docker-compose):"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"USE_MILVUS_LITE"})," \u2013 prep\xedna\u010d embedded vs. server,"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"SEMANTIC_SEARCH_ENABLED"})," \u2013 zap\xednanie/vyp\xednanie s\xe9mantick\xe9ho vyh\u013ead\xe1vania,"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"EMBEDDING_DEVICE"})," \u2013 ",(0,d.jsx)(n.code,{children:"cpu"})," / ",(0,d.jsx)(n.code,{children:"cuda"}),","]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"EMBEDDING_BATCH_SIZE"})," \u2013 ve\u013ekos\u0165 batchu pri generovan\xed embeddingov,"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"CHUNK_LEVEL"})," \u2013 ",(0,d.jsx)(n.code,{children:"paragraph"})," / ",(0,d.jsx)(n.code,{children:"page"}),","]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"MILVUS_COLLECTION_NAME"})," \u2013 n\xe1zov kolekcie,"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"MILVUS_LITE_DB"})," \u2013 cesta k embedded DB s\xfaboru."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:(0,d.jsx)(n.code,{children:"SemanticConfig"})}),"\nobsahuje default hodnoty:"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"MODEL_NAME"}),","]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"EMBEDDING_DIM"}),","]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"MAX_SEQUENCE_LENGTH"}),","]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"MIN_PARAGRAPH_LENGTH"}),","]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"MILVUS_HOST"}),", ",(0,d.jsx)(n.code,{children:"MILVUS_PORT"}),","]}),"\n",(0,d.jsxs)(n.li,{children:["predvolen\xfd ",(0,d.jsx)(n.code,{children:"CHUNK_LEVEL"}),", ",(0,d.jsx)(n.code,{children:"BATCH_SIZE"}),", ",(0,d.jsx)(n.code,{children:"DEVICE"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["Environment variables maj\xfa prednos\u0165 pred hodnotami v ",(0,d.jsx)(n.code,{children:"SemanticConfig"}),", \u010do umo\u017e\u0148uje meni\u0165 spr\xe1vanie bez z\xe1sahov do k\xf3du."]}),"\n",(0,d.jsx)(n.h2,{id:"5-identifikovan\xe9-a-vyrie\u0161en\xe9-kritick\xe9-probl\xe9my",children:"5. Identifikovan\xe9 a vyrie\u0161en\xe9 kritick\xe9 probl\xe9my"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.strong,{children:"Nespr\xe1vne pou\u017eitie OCR v digit\xe1lnych PDF s\xfaboroch"})}),"\n"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"P\xf4vodne sa OCR pou\u017e\xedvalo aj na digit\xe1lnych PDF \u2192 drastick\xe9 spomalenie + straty v diakritike."}),"\n",(0,d.jsxs)(n.li,{children:["Teraz ",(0,d.jsx)(n.code,{children:"_is_digital()"})," rozli\u0161uje typ dokumentu a ",(0,d.jsx)(n.code,{children:"extract()"})," smeruje bu\u010f na ",(0,d.jsx)(n.code,{children:"_extract_digital()"})," (PyMuPDF) alebo ",(0,d.jsx)(n.code,{children:"_extract_ocr()"}),"."]}),"\n"]}),"\n",(0,d.jsxs)(n.ol,{start:"2",children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.strong,{children:"Nekonzistencie vo form\xe1te d\xe1tov\xe9ho kan\xe1la"})}),"\n"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["P\xf4vodn\xfd form\xe1t n-t\xedc bol nekompatibiln\xfd s nov\xfdm ",(0,d.jsx)(n.code,{children:"TextExtractor"}),"om."]}),"\n",(0,d.jsxs)(n.li,{children:["V\u0161etky n\xe1sledn\xe9 komponenty (",(0,d.jsx)(n.code,{children:"TextProcessor"}),", ",(0,d.jsx)(n.code,{children:"SemanticIndexer"}),") pracuj\xfa so slovn\xedkmi (",(0,d.jsx)(n.code,{children:"{'page_num', 'text', 'paragraphs','sentences'}"}),"), \u010do je kompatibiln\xe9 s JSON a zni\u017euje krehkos\u0165 prenosu."]}),"\n"]}),"\n",(0,d.jsxs)(n.ol,{start:"3",children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.strong,{children:"Naivn\xe9 spracovanie textu"})}),"\n"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Jednoduch\xe9 heuristiky l\xe1mali vety pri skratk\xe1ch (\u201eprof.\u201c, \u201enapr.\u201c) a nevedeli spr\xe1vne zlepi\u0165 hyfenizovan\xe9 slov\xe1."}),"\n",(0,d.jsxs)(n.li,{children:["Zaveden\xe1 funkcia ",(0,d.jsx)(n.code,{children:"_clean_whitespace"})," a pou\u017eitie ",(0,d.jsx)(n.code,{children:"nltk.sent_tokenize"})," s podporou sloven\u010diny (",(0,d.jsx)(n.code,{children:"punkt_tab"}),"). \u010cistenie sa vykon\xe1va v jednom"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"architecture-class-diagram",children:"Architecture Class Diagram"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{alt:"EvilFlowers Text Service Architecture Class Diagram",src:i(8318).A+"",width:"1652",height:"970"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}},8318:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/text_service_architecture-23f42604ec0b8529b9130b8b026d44f0.png"},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>c});var s=i(6540);const d={},r=s.createContext(d);function l(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:l(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);